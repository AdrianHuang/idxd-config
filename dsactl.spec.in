Name:		dsactl
Version:	VERSION
Release:	1%{?dist}
Summary:	Configure data streaming accelerator(dsa) subsystem devices
License:	GPLv2
Group:		System Environment/Base
Url:		https://github.com/dsactl
Source0:	https://github.com/%{name}/archive/v%{version}.tar.gz#/%{name}-%{version}.tar.gz

Requires:	LNAME%{?_isa} = %{version}-%{release}
BuildRequires:	autoconf
BuildRequires:	asciidoc
BuildRequires:	xmlto
BuildRequires:	automake
BuildRequires:	libtool
BuildRequires:	pkgconfig
BuildRequires:	pkgconfig(libkmod)
BuildRequires:	pkgconfig(libudev)
BuildRequires:	pkgconfig(uuid)
BuildRequires:	pkgconfig(json-c)
BuildRequires:	pkgconfig(bash-completion)
BuildRequires:	systemd

%description
Utility library for configuring the dsa subsystem.

%package -n DNAME
Summary:	Development files for libdsactl
License:	LGPLv2
Group:		Development/Libraries
Requires:	LNAME%{?_isa} = %{version}-%{release}

%description -n DNAME
The %{name}-devel package contains libraries and header files for
developing applications that use %{name}.


%package -n LNAME
Summary:	Configuration library for dsa subsystem devices
License:	LGPLv2
Group:		System Environment/Libraries

%description -n LNAME
Libraries for %{name}.

%prep
%setup -q dsactl-%{version}

%build
echo %{version} > version
./autogen.sh
%configure --disable-static --disable-silent-rules
make %{?_smp_mflags}

%install
%make_install
find $RPM_BUILD_ROOT -name '*.la' -exec rm -f {} ';'

%check
make check

%post -n LNAME -p /sbin/ldconfig

%postun -n LNAME -p /sbin/ldconfig

%define bashcompdir %(pkg-config --variable=completionsdir bash-completion)
%define udevdir  %(pkg-config --variable=udevdir udev)

%files
%defattr(-,root,root)
%license util/COPYING licenses/BSD-MIT licenses/CC0
%{_bindir}/dsactl
%{_mandir}/man1/dsactl*
%{bashcompdir}/
%{_sysconfdir}/dsactl/config.conf
%{_unitdir}/dsactl-config.service
%{_udevrulesdir}/80-dsactl.rules
%{udevdir}/dsactl-udev

%files -n LNAME
%defattr(-,root,root)
%doc README.md
%license COPYING licenses/BSD-MIT licenses/CC0
%{_libdir}/libdsactl.so.*

%files -n DNAME
%defattr(-,root,root)
%license COPYING
%{_includedir}/dsactl/
%{_libdir}/libdsactl.so
%{_libdir}/pkgconfig/libdsactl.pc

%changelog
